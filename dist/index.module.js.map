{"version":3,"file":"index.module.js","sources":["../src/dragger.js","../src/index.js"],"sourcesContent":["export default class Dragger {\n  constructor(controller) {\n    this.controller = controller;\n\n    this.startPos = [0, 0];\n    this.targetPos = [0, 0];\n  }\n\n  get dialogTarget() {\n    return this.controller.dialogTarget;\n  }\n\n  get dragTarget() {\n    return this.controller.dragTarget;\n  }\n\n  start(pos) {\n    this.startPos = pos;\n    this.targetPos = this.parseTransform(this.dialogTarget);\n    this.dragTarget.classList.add('st-dialog--disable-select');\n  }\n\n  move(pos) {\n    let d = [pos[0] - this.startPos[0], pos[1] - this.startPos[1]];\n    let t = [this.targetPos[0] + d[0], this.targetPos[1] + d[1]];\n    this.dialogTarget.style.transform = `translate(${t[0]}px, ${t[1]}px)`;\n  }\n\n  end() {\n    this.dragTarget.classList.remove('st-dialog--disable-select');\n  }\n\n  parseTransform(element) {\n    let matched = window.getComputedStyle(element).transform.match(/matrix\\((.+)\\)/)\n    if (matched) {\n      let values = matched[1].split(',');\n      return [parseInt(values[4]), parseInt(values[5])];\n    } else {\n      return [0, 0]\n    }\n  }\n}\n","import { Controller } from '@hotwired/stimulus';\nimport '@kanety/stimulus-static-actions';\nimport './index.scss';\n\nimport Dragger from './dragger';\n\nexport default class extends Controller {\n  static targets = ['dialog', 'modal', 'focus', 'drag'];\n  static actions = [\n    ['element', ':open->open'],\n    ['element', ':close->close'],\n    ['element', 'keydown@window->closeByKey'],\n    ['modal', 'click->closeByModal'],\n    ['drag', 'mousedown->dragStart'],\n    ['drag', 'touchstart->dragStart']\n  ];\n  static dragActions = [\n    ['element', 'mousemove@window->dragMove'],\n    ['element', 'touchmove@window->dragMove'],\n    ['element', 'mouseup@window->dragEnd'],\n    ['element', 'touchend@window->dragEnd']\n  ];\n\n  initialize() {\n    this.dragger = new Dragger(this);\n  }\n\n  open(e) {\n    this.openBy(e.target);\n    e.preventDefault();\n  }\n\n  close(e) {\n    this.closeBy(e.target);\n    e.preventDefault();\n  }\n\n  toggle(e) {\n    if (this.isVisible()) {\n      this.closeBy(e.target);\n    } else {\n      this.openBy(e.target);\n    }\n    e.preventDefault();\n  }\n\n  closeByKey(e) {\n    if (e.keyCode == 27) {\n      this.closeBy(e.target);\n      e.preventDefault();\n    }\n  }\n\n  closeByModal(e) {\n    if (!this.dialogTarget.contains(e.target)) {\n      this.closeBy(e.target);\n    }\n  }\n\n  dragStart(e) {\n    let ee = e.changedTouches ? e.changedTouches[0] : e;\n    this.dragger.start([ee.pageX, ee.pageY]);\n    this.context.actionSet.add(this.constructor.dragActions);\n  }\n\n  dragMove(e) {\n    let ee = e.changedTouches ? e.changedTouches[0] : e;\n    this.dragger.move([ee.pageX, ee.pageY]);\n  }\n\n  dragEnd(e) {\n    this.dragger.end([e.pageX, e.pageY]);\n    this.context.actionSet.remove(this.constructor.dragActions);\n  }\n\n  isVisible() {\n    return this.dialogTarget.classList.contains('st-dialog--visible');\n  }\n\n  openBy(target) {\n    this.toggleClass(true);\n\n    if (this.hasFocusTarget) {\n      this.focusTarget.focus();\n    }\n  \n    this.dispatch('opened', { detail: { target: target } });\n  }\n\n  closeBy(target) {\n    this.toggleClass(false);\n\n    this.dispatch('closed', { detail: { target: target } });\n  }\n\n  toggleClass(visible) {\n    if (visible) {\n      this.dialogTarget.classList.add('st-dialog--visible');\n      if (this.hasModalTarget) {\n        this.modalTarget.classList.add('st-dialog-modal--visible');\n        document.body.classList.add('st-dialog--disable-scroll');\n      }\n    } else {\n      this.dialogTarget.classList.remove('st-dialog--visible');\n      if (this.hasModalTarget) {\n        this.modalTarget.classList.remove('st-dialog-modal--visible');\n        document.body.classList.remove('st-dialog--disable-scroll');\n      }\n    }\n  }\n}\n"],"names":["Dragger","constructor","controller","this","startPos","targetPos","dialogTarget","dragTarget","start","pos","parseTransform","classList","add","move","d","t","style","transform","end","remove","element","matched","window","getComputedStyle","match","values","split","parseInt","Controller","initialize","dragger","open","e","openBy","target","preventDefault","close","closeBy","toggle","isVisible","closeByKey","keyCode","closeByModal","contains","dragStart","ee","changedTouches","pageX","pageY","context","actionSet","dragActions","dragMove","dragEnd","toggleClass","hasFocusTarget","focusTarget","focus","dispatch","detail","visible","hasModalTarget","modalTarget","document","body","targets","actions"],"mappings":"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"}